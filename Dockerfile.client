# syntax=docker/dockerfile:1.7
FROM node:22-alpine AS builder

WORKDIR /app
COPY client/package.json client/yarn.lock ./
RUN yarn install --frozen-lockfile

COPY client/ ./
ENV NODE_ENV=production
RUN yarn build

# Runtime
FROM node:22-alpine AS runtime
WORKDIR /app

RUN addgroup -g 1001 nodejs && adduser -S nuxt -u 1001
USER nuxt

COPY --from=builder --chown=nuxt:nodejs /app/.output ./

EXPOSE 3000
ENV PORT=3000 HOST=0.0.0.0

CMD ["node", "server/index.mjs"]